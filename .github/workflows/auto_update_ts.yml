name: Auto-update .ts via lupdate

on:
  workflow_dispatch:

jobs:
  extract-translations:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: Install Qt tools
        run: |
          sudo apt-get update
          sudo apt-get install -y qttools5-dev-tools qttools5-dev

      - name: Run lupdate
        working-directory: geo_search
        run: |
          lupdate . -no-obsolete -ts i18n/*.ts

      - name: Run lrelease
        working-directory: geo_search
        run: |
          lrelease i18n/*.ts || true

      - name: Commit and create PR if .ts changed
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "chore(i18n): update .ts files via lupdate"
          branch: "auto/update-ts-${{ github.run_id }}"
          title: "Auto: update .ts files"
          body: |
            This PR updates translation (.ts) files by running `lupdate` in CI.
            Please review translations and, if correct, merge.
          base: main
          labels: |
            i18n
